DROP TABLE MATERIAL CASCADE;
DROP TABLE PROVEEDOR CASCADE;
DROP TABLE ALBARAN CASCADE;
DROP TABLE CLIENTE CASCADE;
DROP TABLE PRESUPUESTO CASCADE;
DROP TABLE OFERTA CASCADE;
DROP TABLE PEDIDO CASCADE;
DROP TABLE PEDIDO_C CASCADE;
DROP TABLE TIENE CASCADE;
DROP TABLE PIDE CASCADE;

CREATE TABLE MATERIAL(
	ID_MAT varchar(30),
	NOMBRE varchar(30),
	DESCRIPCIÓN varchar(30),
	ZONA varchar(30),
	NICHO varchar(30),
	primary key(ID_MAT)
);

CREATE TABLE PROVEEDOR(
	RUT varchar(30),
	DIRECCION varchar(30),
	NOMBRE varchar(30),
	TELEFONO varchar(30),
	primary key(RUT)
);

CREATE TABLE PEDIDO(
	ID_PED varchar(30),
	RUT_P varchar(30),
	FECHA_P date,
	PRECIO integer,
	primary key(ID_PED),
	foreign key(RUT_P) references PROVEEDOR(RUT)
);

CREATE TABLE ALBARAN( 
	ID_ALB integer,
	ID_PED varchar(30),
	ID_MAT varchar(30),
	FECHA_E date,
	PRECIO integer,
	primary key(ID_ALB),
	foreign key(ID_PED) references PEDIDO(ID_PED),
	foreign key(ID_MAT) references MATERIAL(ID_MAT)
);

CREATE TABLE CLIENTE(
	RUT varchar(30),
	NOMBRE varchar(30),
	DIRECCION varchar(30),
	CODIGO_POSTAL varchar(30),
	TELEFONO integer,
	primary key(RUT)
);

CREATE TABLE PRESUPUESTO(
	ID_PRES varchar(30),
	RUT_C varchar(30),
	PRECIO_TOT integer,
	primary key(ID_PRES),
	foreign key(RUT_C) references CLIENTE(RUT)
);

CREATE TABLE PEDIDO_C(
	ID_PRES varchar(30),
	NUMERO_PEDIDO varchar(30),
	ESTADO varchar(30),
	FECHA date,
	foreign key(ID_PRES) references PRESUPUESTO(ID_PRES)
);

CREATE TABLE TIENE(
	ID_MAT varchar(30),
	ID_ALB integer,
	PRECIO integer,
	CANTIDAD integer,
	foreign key(ID_MAT) references MATERIAL(ID_MAT),
	foreign key(ID_ALB) references ALBARAN(ID_ALB)
);

CREATE TABLE PIDE(
	ID_MAT varchar(30),
	ID_PED varchar(30),
	PRECIO integer,
	CANTIDAD integer,
	foreign key(ID_MAT) references MATERIAL(ID_MAT),
	foreign key(ID_PED) references PEDIDO(ID_PED)
);

CREATE TABLE OFERTA(
	ID_MAT varchar(30),
	RUT_P varchar(30),
	PRECIO integer,
	foreign key(ID_MAT) references MATERIAL(ID_MAT),
	foreign key(RUT_P) references PROVEEDOR(RUT)
);

INSERT INTO MATERIAL(ID_MAT, NOMBRE, DESCRIPCIÓN, ZONA, NICHO) VALUES
('MAT9568', 'pavimento de gres', 'asd', 'area51', 'ultima puerta'),
('MAT9865', 'hormigon armado', 'asd', 'area65', 'techo'),
('MAT5421', 'cemento', 'construccion', 'area13', 'adelante');

INSERT INTO PROVEEDOR(RUT, DIRECCION, NOMBRE, TELEFONO) VALUES
('17.042.140-K', 'GABRIELA MISTRAL 651', 'JAVIER ARRIAGADA', '57659878'),
('18.780.980-8', 'AVENIDA COLLAO 755, DEP 10010', 'LISSETE LECHUGA', '72913703'),
('19.088.874-6', 'MAQUI 1486, VILLA UDEC', 'PABLO VENEGAS', '2345678');

INSERT INTO PEDIDO(ID_PED, RUT_P, FECHA_P, PRECIO) VALUES
('PED5671', '19.088.874-6', '2004-02-15', '1598624'),
('PED8754', '17.042.140-K', '2007-08-12', '3216547'),
('PED9821', '18.780.980-8', '1998-06-18', '958487'),
('PED2589', '18.780.980-8', '2001-01-15', '149685');

INSERT INTO ALBARAN(ID_ALB,ID_PED,ID_MAT,FECHA_E,PRECIO) VALUES
('258', 'PED8754', 'MAT9865', '2007-08-12', '3216547'),
('123', 'PED9821', 'MAT9568', '1998-06-18', '958487'),
('698', 'PED2589', 'MAT9568', '2001-01-15', '149685'),
('859', 'PED5671', 'MAT5421', '2004-02-15', '1598624');

INSERT INTO CLIENTE(RUT, NOMBRE, DIRECCION, CODIGO_POSTAL, TELEFONO) VALUES
('15.265.854-1','CARLOS PROVOSTE','SU CASA 16','5974189','64889766'),
('17.042.140-k','CHRISTIAN CHUAS','CARMELITAS 37','321547','84517962'),
('20.265.621-8','PABLO NICE','ASD954','9875126','85426521');

INSERT INTO PRESUPUESTO(ID_PRES,RUT_C,PRECIO_TOT) VALUES
('PRE321','20.265.621-8','65872154'),
('PRE658','17.042.140-k','62134587'),
('PRE258','15.265.854-1','69541258');

INSERT INTO PEDIDO_C(ID_PRES,NUMERO_PEDIDO,ESTADO,FECHA) VALUES
('PRE321','NUMPED321','ENTREGADO','2016-10-12'),
('PRE658','NUMPED963','ENTREGADO','2016-10-22'),
('PRE321','NUMPED147','PEDIDO','2008-04-06'),
('PRE258','NUMPED654','ENTREGADO','2007-03-03'),
('PRE658','NUMPED987','ENTREGADO','2010-06-12');

INSERT INTO TIENE(ID_MAT,ID_ALB, PRECIO, CANTIDAD) VALUES
('MAT9865','258','3216547','45'),
('MAT9568','123','958487','35'),
('MAT9568','698','149685','58'),
('MAT5421','859','1598624','27');

INSERT INTO PIDE(ID_MAT,ID_PED, PRECIO, CANTIDAD) VALUES
('MAT9568','PED2589','6549874','10'),
('MAT9865','PED8754','3219875','12'),
('MAT5421','PED5671','9518475','15'),
('MAT9568','PED9821','3268751','09');

INSERT INTO OFERTA(ID_MAT, RUT_P, PRECIO) VALUES
('MAT9568','17.042.140-K','6548147'),
('MAT5421','18.780.980-8','9584875'),
('MAT9865','19.088.874-6','3216547');


/*Nombre de los proveedores que han suministrado hormigón armado a la
compañía desde el 1 de enero de 2000*/
SELECT DISTINCT	PROVEEDOR.NOMBRE
FROM 	MATERIAL,PIDE,PEDIDO,PROVEEDOR,PRESUPUESTO,CLIENTE
WHERE 	MATERIAL.NOMBRE = 'hormigon armado' AND
		MATERIAL.ID_MAT = PIDE.ID_MAT AND
		PIDE.ID_PED = PEDIDO.ID_PED AND
		PEDIDO.FECHA_P >= '2000-01-01' AND
		PEDIDO.RUT_P = PROVEEDOR.RUT AND
		PRESUPUESTO.RUT_C = CLIENTE.RUT


/*Total de unidades (metros cuadrados) de pavimento de gres vendidas en
el último mes*/
SELECT 	SUM(CANTIDAD) AS CANTIDAD
FROM	MATERIAL,PEDIDO_C
WHERE 	MATERIAL.NOMBRE = 'pavimento de gres' AND
		MATERIAL.ID_MAT = PIDE.ID_MAT AND
		PIDE.ID_PED = PEDIDO_C.NUMERO_PEDIDO AND
		PEDIDO_C.FECHA_P >= (CURRENT_DATE - 30) 




/*Nombre de los clientes que han solicitado presupuestos superiores a 60.000*/
SELECT 	CLIENTE.NOMBRE
FROM 	PRESUPUESTO,CLIENTE
WHERE	PRESUPUESTO.PRECIO_TOT > '60000' AND
		PRESUPUESTO.RUT_C = CLIENTE.RUT
				



)